<link rel="import" href="../../behaviors/taaabs-stylesheet.html">

<dom-module id="taaabs-trace">
  <style>
    :host {
      display: block;
    }
  </style>
  <template>
    <h1 class="paper-font-display1"><span>taaabs-trace</span></h1>
    <h2 class="paper-font-display2"><span>{{ktbsTraceUrl}}</span></h2>

    <paper-tabs selected="{{outterSelected}}">
      <paper-tab>Trace Visualization</paper-tab>
      <paper-tab>Model Visualization</paper-tab>
      <paper-tab>Setting Visualization</paper-tab>
      <paper-tab>Stylesheet Visualization</paper-tab>
    </paper-tabs>
    <iron-pages selected="{{outterSelected}}">
      <paper-material elevation="2" class="trace-visualization">
        <taaabs-trace-visualization
          selected="{{outterSelected}}"
          trace="{{trace}}"
          options="{{options}}">
        </taaabs-trace-visualization>
      </paper-material>
      <paper-material elevation="2" class="Model Visualization">
          <taaabs-model
            trace="{{trace}}"
            options="{{options}}"
            model="{{model}}">
          </taaabs-model>
      </paper-material>
      <paper-material elevation="2"></paper-material>
      <paper-material elevation="2">
        <taabs-stylesheet
            trace="{{trace}}"
            options="{{options}}"
            model="{{model}}">
        </taabs-stylesheet>
      </paper-material>
    </iron-pages>
  </template>

  <script>
    (function () {
      /* global Polymer, Samotraces */

      Polymer({
        is: 'taaabs-trace',
        behaviors: [
          TaaabsBehaviors.Stylesheet
        ],
        properties: {
          encodedKtbsTraceUrl: {
            type: String,
            observer: '_encodedKtbsTraceUrlChanged'
          },
          ktbsTraceUrl: {
            type: String,
            observer: '_ktbsTraceUrlChanged'
          },
          trace: {
            type: Object,
            observer: '_tracelChanged'
          },
          model: {
            type: Object
          },
          options: {
            type: String,
            notify:true
          },
          outterSelected: {
            type: Number,
            value: 0
          }
        },
        _encodedKtbsTraceUrlChanged: function(encodedKtbsTraceUrl) {
          this.set('ktbsTraceUrl', decodeURIComponent(encodedKtbsTraceUrl));
        },
        _ktbsTraceUrlChanged: function(ktbsTraceUrl) {
          // objetTrace
          this.set('trace', new Samotraces.Ktbs.Trace(ktbsTraceUrl));
        },
        _tracelChanged:function (newValue){
          var that = this ;
          //Objet model
          newValue.on('trace:model',function(){
            var modelUri = newValue.get_model(); // jshint ignore:line
            that.set('model', new Samotraces.Ktbs.Model(modelUri));
          });
          //options stylesheet
          that._getStylesheet(that.trace.get_uri()).then(function(stylesheet) { // jshint ignore:line
            that.set('options', stylesheet);
          });
            that.trace.list_obsels();
        }

      });
    })();
  </script>

</dom-module>


<dom-module id="taaabs-trace-display-icons">

  <link rel="import" type="css" href="../../bower_components/samotracesjs/dist/samotraces.css"/>

  <template>
    <div id="widget"></div>
  </template>

  <script>
    /* global Polymer, Samotraces, $ */

    Polymer({
      is: 'taaabs-trace-display-icons',
      properties: {
        timewindow: {
          type: Object,
          reflectToAttribute: true,
          notify: true,
          observer: 'timeChanged'
        },
        trace: {
          type: Object,
          notify: true,
          observer: 'traceChanged'
        },
        obselSelector: {
          type: Object,
          reflectToAttribute: true,
          notify: true
        },
        options: {
          type: Object,
          reflectToAttribute: true,
          notify: true
        }
      },
      traceChanged: function() {
        this.attachWidget();
      },
      timeChanged: function() {
        this.attachWidget();
      },
      attached: function() {
        this.attachWidget();
      },
      observObsels: function() {
        // this is a NodeList, not an Array, so no forEach
        var obselsNodeList = this.shadowRoot.querySelectorAll('.Samotraces-obsel');
        for (var i = 0; i < obselsNodeList.length; i++) {
          var obsel = obselsNodeList[i];
          obsel.onclick = this.handleClick.bind(this);
        }
      },
      handleClick: function(event) {
        var obsel = $.data(event.target, 'Samotraces-data'); // TODO we assume jquery is avaible
        this.obselSelector.select(obsel);
      },
      attachWidget: function() {
        if (!! this.trace && !! this.timewindow) {
          var widgetElement = this.$$('#widget');
          var options = {
              url: function(o) {
                  return 'images/teapot.png';
              },
              width: 34,
              height: 40,
          };
          // Create widget
          this.widgetObject = new Samotraces.Ui.Widgets.TraceDisplayIcons(widgetElement, this.trace, this.timewindow, options);
        }
      }
    });
  </script>
</dom-module>

<link rel="import" href="../../bower_components/polymer/polymer.html"/>

<dom-module id="taaabs-base">
  <template>
    <h2 style="margin-left: 50%;"> Interface Base </h2>
    <div>{{baseSel.id}}</div>
    <div id="base-url">{{basesel.id}}</div>
    <div id= "base-label">{{basesel.label}}</div>
    <div id="trace-list" style="width: 50%;float: left;">  </div>
    <div id="model-list">  </div>
  </template>

  <script src="../../bower_components/samotracesjs/src/UI/Widgets/ListTracesInBases.js"></script>
  <script src="../../bower_components/samotracesjs/src/UI/Widgets/ListModelInBases.js"></script>
  <script src="../../bower_components/samotracesjs/src/core/KTBS.Trace.js"></script>
  <script src="../../bower_components/samotracesjs/src/core/KTBS.Model.js"></script>

  <script>
    /* global Polymer, Samotraces */

    Polymer({
      is: "taaabs-base",
      properties: {
        base: {
          type: Object,
          notify: true,
          reflectToAttribute: true,
          value: function() { return {}; },
          observer: '_baseselChanged'
        },
        tracesel: {
          type: Object,
          notify: true,
          reflectToAttribute: true,
          value: function() { return {}; }
        },
        modelsel: {
          type: Object,
          notify: true,
          reflectToAttribute: true,
          value: function() { return {}; }
        }
      },
      _listTrace: function() {
        var BaseButton = this.$["trace-list"].querySelectorAll('.trace');
        for (var i = 0; i < BaseButton.length; i++) {
          BaseButton[i].onclick = this._clickTrace.bind(this);
        }
      },
      _listModel: function(){
        var BaseButton = this.$["model-list"].querySelectorAll('.model');
        for (var i = 0; i < BaseButton.length; i++) {
          BaseButton[i].onclick = this._clickModel;
        }
      },
      _clickTrace: function(event) {
        var traceURL = this.base.id + event.srcElement.innerText;
        this.tracesel = new Samotraces.KTBS.Trace(traceURL);
      },
      _clickModel: function(event) {
        var modelURL = this.base.id + event.srcElement.innerText;
        this.modelsel = new Samotraces.KTBS.Model(modelURL);
      },
      _baseselChanged: function(newValue) {
        this.$["trace-list"].innerHTML = "";
        this.$["model-list"].innerHTML = "";
        var listTracewidget = new Samotraces.UI.Widgets.ktbs.ListTracesInBases(this.$["trace-list"], newValue, '');
        var listModelwidget = new Samotraces.UI.Widgets.ktbs.ListModelInBases(this.$["model-list"], newValue, '');
        listTracewidget.on("ListTrace", this._listTrace.bind(this));
        listModelwidget.on("ListModel", this._listModel.bind(this));
      }
    });
  </script>
</dom-module>
